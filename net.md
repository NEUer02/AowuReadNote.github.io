# 网络是如何连接的

参考书目：《网络是如何连接的》 户根勤  

本页内容来自于个人学习笔记与感悟。 
仅限于学习交流，请勿商用。

## 第一章

### 1-1 从浏览器开始

网络连接从输入**网址**（**URL**, Uniform Resource Locator, 统一资源定位符）开始。不论是我们在浏览器上直接输入网址，还是点击网页中的链接，本质上都是在不同的网址之间跳转。所以本书就从浏览器的工作开始介绍网络是如何连接的。 
当你在浏览器中输入网址之后，浏览器的工作步骤如下：

1. **解析**输入的网址；
2. 根据当前情况与URL中涉及的相关协议生成**请求消息**；
3. 接收、解析收到的**响应消息**；

接下来对于上述步骤进行进一步的描述。  

#### 1-1-1 解析网址

在浏览器中可以输入的网址种类有很多，例如“http://......”、“ftp://......”和“file://......”等等。其中“http:”、“ftp:”和“file:”这部分字段表示需要浏览器使用的访问方法（协议）。例如访问Web网站一般使用HTTP（HTTP, Hypertext Transfer Protocol, 超文本传输协议）协议，访问FTP服务器一般使用FTP协议......不同的协议所需要的后续字段是不同的，结构上也有些许的差别。 
浏览器解析网址的过程也就是从网址的不同字段中提取出所需要的信息，以便于生成向服务器发送的请求消息。 
以访问Web服务器为例，即使用HTTP协议： 
一般网址格式为http://user:password@www.xxxx.com:80/dir/file1.htm，其对应的字段含义如下：

| 协议   | 用户名（可省略） | 密码 （可省略） | Web服务器域名     | 端口（可省略） | 文件路径名（可省略）     |
| ---- | -------- | -------- | ------------ | ------- | -------------- |
| http | user     | password | www.xxxx.com | 80      | /dir/file1.htm |

相对应的解释为：根据“HTTP”规定的格式和步骤，使用“user”和“password”从“80端口”登录“www.xxxx.com”，对“/dir/file1.htm”下的文件进行操作。

例如网址"http://www.baidu.com"可以解释为使用HTTP协议访问地址为"www.baidu.com"的Web服务器。其中用户名、密码、端口号和文件路径均被省略。

- 关于端口： 
  不同的服务器程序会使用不同的端口编号，例如Web服务使用80端口，邮件端口为25端口等等。后续会有更详细的介绍。

- 关于路径名： 
  路径名称可以有不同程度上的省略。有以下几种情况： 
  1、什么都不写，例如"http://www.baidu.com"； 
  2、只写根目录，例如"http://www.baidu.com/"； 
  3、没有明确表示文件或文件夹，例如"http://www.lab.glasscom.com/whatisthis"； 
  针对第一、二种情况，Web服务器会返回设置的默认文件，类似于index.html或default.html等这类的文件。这个默认文件也被称为主页（home page），不过现在这个词已经有点被玩坏了...... 
  针对于第三种情况，按照惯例来说，文件系统中不应存在同名的文件和文件夹，所以直接去路径下寻找，如果是文件夹就按照文件夹处理，如果是文件就按照文件处理。

#### 1-1-2 生成请求消息

根据1.1.1节的网址解析过程，浏览器已经知道要访问的目标在哪里了，之后会根据HTTP协议去访问相应的Web服务器。具体的过程分为两个步骤：  

1. 生成请求消息并发送给服务器；
2. 接收服务器的响应消息并进行有关操作。

本节便重点介绍第一步，即生成请求消息。 
请求消息中包含三个部分：

1. 方法（也叫HTTP谓词、HTTP动词），即“进行怎样的操作”；
2. URI（URI, Uniform Resource Identifier, 统一资源标识符），即“对哪个对象”；
3. 消息头（其中每一行包含一个头字段）；

首先发送HTTP动词，再发送URI，下一行紧跟消息头，再经过一个空行后，为从客户端发向服务器的数据。  

![](/Users/pangaowu/Documents/GitHub/AowuReadNote.github.io/data/picture/net/请求消息.png)

URI一般是存放网页数据的文件名或者一个CGI程序。 

“方法”表示需要让Web服务器完成怎样的工作，例如：读取URI指向的文件、将客户端数据发送到URI指向的程序等等（还有很多方法，可以参考参考书目第12页，在此不多赘述）。 关于方法的选择关键在于浏览器的工作状态。选取哪种方法也是根据场景来决定的。

- 关于方法：
  
  HTTP协议中提供了很多可用的方法，具体可见参考书目第十二页表1.1 
  
  这里重点介绍两种常用的方法。GET方法和POST方法。
  
  GET方法指获取URI指向的信息。如果URI指向的是文件，则返回文件的内容；如果URI指向的是程序，则返回程序的输出数据。
  
  POST方法是从客户端向服务器发送数据，一般用于发送表单中填写的数据等情况。例如在网站上填写调查问卷，点击“提交”时，便会调用该方法。

#### 1-1-3 接收响应消息

当我们将上述的请求消息发出后，Web服务器会返回一个响应消息。第六章会有更加详细的解释，这里将简单的介绍一下。响应消息的格式与请求消息大同小异。具体格式如图所示：

![](/Users/pangaowu/Documents/GitHub/AowuReadNote.github.io/data/picture/net/响应消息.png)

这里需要注意，在请求消息中，HTTP版本在最后面，而在响应消息中，HTTP版本在最前面。

状态码与响应短语对应，均用于表示请求的执行结果是成功还是出错。区别在于，状态码是一个数字，主要用于向机器表示执行结果；而响应短语是一段文字，主要用于向人表示执行结果。具体的状态码请见参考书目第二十页表1.3

收到返回消息之后，浏览器会将数据显示出来。如果有图像，则会进一步处理。

- 关于图像：
  
  网页中图像的本质就是存放在服务器上的一张图片。
  
  当网页中包含图像时，会在网页文件的相应位置嵌入表示图片文件的标签的控制信息。浏览器在显示文字时会搜索相应的标签，当遇到图片相关的标签时，会在屏幕上留出图像的空间，之后向Web服务器发送请求相关图片的消息，获得服务器上的相关图片，再填充到留出的空间上。
  
  这个过程与获得网页内容的过程是一致的，只需要将URI改为指向对应图片即可。
  
  如果一个网页中包含有多个图像，那么浏览器在浏览该网页时首先请求获得网页内容，之后请求获得第一张图片，然后请求获得第二章图片......以此类推，直到对网页内容补充完整。

在对于浏览器如何显示图像的解释过程中，蕴含着一个非常重要的概念，即：

**1条请求消息中只能写一个URI。如果需要获得多个文件，必须对每个文件单独发送1条请求。**


